<?xml version="1.0" encoding="UTF-8"?>

<chapter xml:id="configuring-guacamole" 
    xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en"
    xmlns:xi="http://www.w3.org/2001/XInclude">

    <title>Configuring Guacamole</title>

    <!--
    - Initial setup
    -->

    <section xml:id="initial-setup">
        <title>Initial setup</title>
        <indexterm xmlns:xl="http://www.w3.org/1999/xlink">
            <primary>guacamole.properties</primary>
        </indexterm>
        <indexterm xmlns:xl="http://www.w3.org/1999/xlink">
            <primary>configuration</primary>
            <secondary>Guacamole</secondary>
        </indexterm>
        <indexterm xmlns:xl="http://www.w3.org/1999/xlink">
            <primary>Guacamole</primary>
            <secondary>configuring</secondary>
        </indexterm>
        <para>The Guacamole web application uses one main configuration file
            called <filename>guacamole.properties</filename> which must be in
            the classpath of your servlet container. This file is the common
            location for all configuration properties read by Guacamole or any
            extension of Guacamole, including authentication providers. </para>
        <para>At the bare minimum, the <filename>guacamole.properties</filename>
            file provides four basic properties: </para>
        <variablelist>
            <varlistentry>
                <term><indexterm xmlns:xl="http://www.w3.org/1999/xlink">
                        <primary>guacd-host</primary>
                    </indexterm><parameter>guacd-host</parameter></term>
                <listitem>
                    <para>The host the Guacamole proxy daemon (guacd) is
                        listening on. This is most likely localhost. </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><indexterm xmlns:xl="http://www.w3.org/1999/xlink">
                        <primary>guacd-port</primary>
                    </indexterm><parameter>guacd-port</parameter></term>
                <listitem>
                    <para>The port the Guacamole proxy daemon (guacd) is
                        listening on. This is port 4822 by default. </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><indexterm xmlns:xl="http://www.w3.org/1999/xlink">
                        <primary>auth-provider</primary>
                    </indexterm><parameter>auth-provider</parameter></term>
                <listitem>
                    <para>The authentication provider to use when
                        authenticating. Normally, this will be set to
                            <classname>BasicFileAuthenticationProvider</classname>
                        which is the default authentication provider provided
                        with Guacamole. </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><indexterm xmlns:xl="http://www.w3.org/1999/xlink">
                        <primary>lib-directory</primary>
                    </indexterm><parameter>lib-directory</parameter></term>
                <listitem>
                    <para>The directory to load extensions to Guacamole from. If
                        you wish to use a custom authentication provider or
                        custom hooks, the .jar file and all dependencies must be
                        placed in the directory specified here. </para>
                </listitem>
            </varlistentry>
        </variablelist>
        <example>
            <title>Minimal <filename>guacamole.properties</filename></title>
            <xi:include href="conf/guacamole.properties.xml"/>
        </example>
    </section>

    <!--
    - Authentication
    -->

    <section xml:id="authentication-setup">
        <title>Authentication</title>
        <indexterm xmlns:xl="http://www.w3.org/1999/xlink">
            <primary>user-mapping.xml</primary>
        </indexterm>
        <indexterm xmlns:xl="http://www.w3.org/1999/xlink">
            <primary>authentication</primary>
        </indexterm>
        <para>Guacamole's authentication model is simple and consists of a
            mapping of usernames to configurations. Each username has a
            corresponding password and associated set of configurations, and
            each configuration has a protocol and protocol-specific set of
            parameters. The example <filename>user-mapping.xml</filename> file
            included with Guacamole is a fairly good example of this concept. </para>
        <para>Authentication is configured by editing guacamole.properties and
            setting the authentication provider property:
                <property>auth-provider</property>. </para>
        <para>Guacamole comes with an authentication provider,
                <classname>BasicFileAuthenticationProvider</classname>, which
            simply reads usernames and passwords from an XML file. </para>
    </section>

    <!--
    - Adding users and connections
    -->

    <section xml:id="connection-setup">
        <title>Adding users and connections</title>
        <indexterm xmlns:xl="http://www.w3.org/1999/xlink">
            <primary>users</primary>
            <secondary>adding</secondary>
        </indexterm>
        <indexterm xmlns:xl="http://www.w3.org/1999/xlink">
            <primary>connections</primary>
            <secondary>adding</secondary>
        </indexterm>
        <para>The default authentication provider used by Guacamole reads all
            username, password, and configuration information from a file called
            the "user mapping" (typically named
                <filename>user-mapping.xml</filename>). Other authentication
            providers can be written which read authentication information from
            other sources, but those are not documented here. To learn how to
            configure an authentication provider not included in the main
            Guacamole bundle, consult the documentation provided with that
            authentication provider. </para>
        <example>
            <title>A simple <filename>user-mapping.xml</filename></title>
            <xi:include href="conf/user-mapping.xml.xml"/>
        </example>
    </section>
    <section>
        <title>Protocols</title>
        <para>Support for individual protocols is provided by libraries called
            "client plugins" which are all named according to the
                    <package>libguac-client-<replaceable>PROTOCOL</replaceable></package>
            convention.</para>
        <para>The mechanism that you specify the protocol and any associated
            parameters will vary by authentication provider. If you are using
            the default authentication provider, protocols are specified with a
                <code>&lt;protocol></code> tag and parameters and their values
            are specified with any number of corresponding
                <code>&lt;param></code> tags. See the example
                <filename>user-mapping.xml</filename> above for examples of how
            these tags should be written.</para>
    </section>
    <section>
        <title>VNC</title>
        <para>The VNC protocol is the simplest and first protocol supported by
            Guacamole. Although generally not as fast as RDP, many VNC servers
            are adequate, and VNC over Guacamole tends to be faster than VNC by
            itself due to decreased bandwidth usage.</para>
        <para>VNC support for Guacamole is provided by the libguac-client-vnc
            library, installed by default.</para>
        <section>
            <title>Configuration parameters</title>
            <variablelist>
                <varlistentry>
                    <term>hostname</term>
                    <listitem>
                        <para>The hostname or IP address of the VNC server
                            Guacamole should connect to.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>port</term>
                    <listitem>
                        <para>The port the VNC server is listening on, usually
                            5900 or 5900 + <replaceable>display
                                number</replaceable>. For example, if your VNC
                            server is serving display number 1 (sometimes
                            written as <constant>:1</constant>), your port
                            number here would be 5901.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>password</term>
                    <listitem>
                        <para>The password to use when attempting
                            authentication, if any. This parameter is
                            optional.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>read-only</term>
                    <listitem>
                        <para>Whether this connection should be read-only. If
                            set to "true", no input will be accepted on the
                            connection at all. Users will only see the desktop
                            and whatever other users using that same desktop are
                            doing. This parameter is optional.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>swap-red-blue</term>
                    <listitem>
                        <para>If the colors of your display appear wrong (blues
                            appear orange or red, etc.), it may be that your VNC
                            server is sending image data incorrectly, and the
                            red and blue components of each color are swapped.
                            If this is the case, set this parameter to "true" to
                            work around the problem. This parameter is
                            optional.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>encodings</term>
                    <listitem>
                        <para>A space-delimited list of VNC encodings to use.
                            The format of this parameter is dictated by
                            libvncclient and thus doesn't really follow the form
                            of other Guacamole parameters. This parameter is
                            optional, and libguac-client-vnc will use any
                            supported encoding by default.</para>
                        <para>Beware that this parameter is intended to be
                            replaced with individual, encoding-specific
                            parameters in a future release.</para>
                    </listitem>
                </varlistentry>
            </variablelist>
        </section>
    </section>
    <section>
        <title>RDP</title>
        <para>The RDP protocol is more complicated than VNC and was the second
            protocol officially supported by Guacamole. RDP tends to be faster
            than VNC due to the use of caching, which Guacamole does take
            advantage of.</para>
        <para>RDP support for Guacamole is provided by the libguac-client-rdp
            library, which depends on a recent version of FreeRDP (version 1.0
            or higher). If your distribution does not have a recent enough
            version of FreeRDP, the Guacamole project will not build a
            libguac-client-rdp package for you. You will need to build and
            install a recent version of FreeRDP, and then build and install
            libguac-client-rdp from source.</para>
        <section>
            <title>Configuration parameters</title>
            <variablelist>
                <varlistentry>
                    <term>hostname</term>
                    <listitem>
                        <para>The hostname or IP address of the RDP server
                            Guacamole should connect to.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>port</term>
                    <listitem>
                        <para>The port the RDP server is listening on, usually
                            3389. This parameter is optional. If this is not
                            specified, the default of 3389 will be used.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>username</term>
                    <listitem>
                        <para>The username to use to authenticate, if any. This
                            parameter is optional.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>password</term>
                    <listitem>
                        <para>The password to use when attempting
                            authentication, if any. This parameter is
                            optional.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>domain</term>
                    <listitem>
                        <para>The domain to use when attempting authentication,
                            if any. This parameter is optional.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>color-depth</term>
                    <listitem>
                        <para>The color depth to request, in bits-per-pixel.
                            This parameter is optional. If specified, this must
                            be either 8, 16, or 24. Regardless of what value is
                            chosen here, if a particular update uses less than
                            256 colors, Guacamole will always send that update
                            as a 256-color PNG.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>width</term>
                    <listitem>
                        <para>The width of the display to request, in pixels.
                            This parameter is optional. If this value is not
                            specified, the width of the connecting client
                            display will be used instead.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>height</term>
                    <listitem>
                        <para>The height of the display to request, in pixels.
                            This parameter is optional. If this value is not
                            specified, the height of the connecting client
                            display will be used instead.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>disable-audio</term>
                    <listitem>
                        <para>As of Guacamole version 0.7.0, audio is officially
                            support and enabled by default in both the client
                            and in libguac-client-rdp. If you are concerned
                            about bandwidth usage, or sound is causing problems,
                            you can explicitly disable sound by setting this
                            parameter to "true".</para>
                    </listitem>
                </varlistentry>
            </variablelist>
        </section>
    </section>

</chapter>
