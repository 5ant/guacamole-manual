<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook V5.0//EN"
    "http://docbook.org/xml/5.0/dtd/docbook.dtd">

<chapter id="installing" 
    xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en"
    xmlns:xl="http://www.w3.org/1999/xlink"
    xmlns:xi="http://www.w3.org/2001/XInclude">

    <title>Installing Guacamole</title>
    <indexterm>
        <primary>Guacamole</primary>
        <secondary>installing</secondary>
    </indexterm>

    <!--
    - From packages 
    -->

    <section id="getpackages">

        <title>Pre-built packages</title>
        <indexterm>
            <primary>packages</primary>
            <secondary>pre-built</secondary>
        </indexterm>

        <para>
            By far, the easiest way to install Guacamole is through pre-built
            binary packages. Binary packages are provided with every Guacamole
            release for several Linux distributions, and there may be Guacamole
            packages available in the official repository of your distribution.
        </para>

        <para>
            If your distribution provides Guacamole packages for you, this is
            the preferred method of installing Guacamole. Install your
            distribution's Guacamole package, and then follow the common
            instructions here for configuring Guacamole once it is installed.
        </para>

        <para>
            If your distribution does not provide Guacamole packages, or the
            packages provided are too old, you can try the packages built by
            the Guacamole project with every release. If the Guacamole project
            does not provide packages for your specific distribution, you will
            need to build everything yourself from source.
        </para>

        <section id="supported">

            <title>Supported distribution versions</title>
            <indexterm>
                <primary>Linux</primary>
                <secondary>supported versions</secondary>
            </indexterm>

            <para>
                The Guacamole project supports all stable versions of Debian,
                Ubuntu, and Fedora which have not reached end-of-life. The
                only exception to this is when a particular version cannot
                be supported because the upstream repository is missing a
                critical dependency, in which case some or all of the
                packages built by the Guacamole project will not be available
                for that distribution.
            </para>

            <para>
                Packages for all supported versions of Linux distributions are
                available from the <link
                    xl:href="http://guac-dev.org/">Guacamole web site</link>.
                <indexterm>
                    <primary>Guacamole</primary>
                    <secondary>downloading</secondary>
                </indexterm>
            </para>

        </section>

        <section id="bindepends">

            <title>Installing Dependencies</title>
            <indexterm>
                <primary>Guacamole</primary>
                <secondary>dependencies</secondary>
            </indexterm>

            <para>
                Different components of Guacamole depend on different packages
                provided by your distribution in order to function.
            </para>

            <para>
                The Guacamole web application depends on a servlet container
                like Apache Tomcat. This guide assumes you are using Apache
                Tomcat as your servlet container, but others will work as well.
                You will need to consult the documentation of your chosen
                servlet container for any details regarding installation of web
                applications.
            </para>

            <para>
                <indexterm>
                    <primary>Guacamole</primary>
                    <secondary>dependencies</secondary>
                    <tertiary>Debian</tertiary>
                </indexterm>
                <indexterm>
                    <primary>Guacamole</primary>
                    <secondary>dependencies</secondary>
                    <tertiary>Ubuntu</tertiary>
                </indexterm>
                For Debian and Ubuntu, Apache Tomcat is provided by the
                <package>tomcat6</package> package, while the VNC library
                required for VNC support is provided by
                <package>libvncserver0</package>, and RDP support is provided
                by <package>libfreerdp1</package>.
            </para>

            <example>
                <title>Installing Guacamole dependencies on Debian or Ubuntu</title>
                <screen>
<prompt>$</prompt> <command>sudo <option>apt-get</option> <option>install</option> <option>tomcat6</option> <option>libvncserver0</option> <option>libfreerdp1</option></command>
                </screen>
            </example>

            <para>
                <indexterm>
                    <primary>Guacamole</primary>
                    <secondary>dependencies</secondary>
                    <tertiary>Fedora</tertiary>
                </indexterm>
                The Apache Tomcat package for Fedora is also called
                <package>tomcat6</package>. VNC support is provided by
                <package>libvncserver</package>, and RDP support is provided by
                <package>freerdp</package>.
            </para>

            <example>
                <title>Installing Guacamole dependencies on Fedora</title>
                <screen>
<prompt>$</prompt> <command>su</command>
<prompt>Password:</prompt> <replaceable>password</replaceable>
<prompt>#</prompt> <command>yum <option>install</option> <option>tomcat6</option> <option>libvncserver</option> <option>freerdp</option></command>
                </screen>
            </example>

        </section>

        <section id="installingpackages">
            
            <title>Installing Guacamole packages</title>
            <indexterm>
                <primary>Guacamole</primary>
                <secondary>packages</secondary>
                <tertiary>installing</tertiary>
            </indexterm>

            <para>
                Once dependencies are installed, the official Guacamole
                packages can be installed.  Guacamole is split into multiple
                packages, one package providing the web application, others
                providing the native components (proxy daemon and library) or
                support for specific protocols (VNC and RDP).
            </para>

            <para>
                The easiest way to obtain all packages in one fell swoop is to
                download the "bundle" archive of the latest release from the
                <link xl:href="http://guac-dev.org/">Guacamole web site</link>.
                <indexterm>
                    <primary>Guacamole</primary>
                    <secondary>downloading</secondary>
                    <tertiary>bundles</tertiary>
                </indexterm>
            </para>

            <example>
                <title>Installing Guacamole packages on Debian or Ubuntu</title>
<screen>
<prompt>$</prompt> <command>tar -xzf guacamole-0.6.2-ubuntu-12.04-amd64.tar.gz</command>
<prompt>$</prompt> <command>cd guacamole-0.6.2-ubuntu-12.04-amd64/</command>
<prompt>$</prompt> <command>ls</command>
<computeroutput>guacamole_0.6.1-1_all.deb         libguac-client-rdp0_0.6.1-1_amd64.deb
guacamole-tomcat_0.6.1-1_all.deb  libguac-client-vnc0_0.6.0-1_amd64.deb
guacd_0.6.1-1_amd64.deb           libguac-dev_0.6.2-1_amd64.deb
libguac3_0.6.2-1_amd64.deb</computeroutput>
<prompt>$</prompt> <command>sudo dpkg -i *.deb</command>
</screen>
            </example>

            <example>
                <title>Installing Guacamole packages on Fedora</title>
<screen>
<prompt>$</prompt> <command>tar -xzf guacamole-0.6.2-fedora-17-x86_64.tar.gz</command>
<prompt>$</prompt> <command>cd guacamole-0.6.2-fedora-17-x86_64/</command>
<prompt>$</prompt> <command>ls</command>
<computeroutput>guacamole-0.6.1-1.noarch.rpm  libguac3-devel-0.6.2-1.x86_64.rpm
guacd-0.6.1-1.x86_64.rpm      libguac-client-rdp-0.6.1-1.x86_64.rpm
libguac3-0.6.2-1.x86_64.rpm
libguac-client-vnc0-0.6.0-1.x86_64.rpm</computeroutput>
<prompt>$</prompt> <command>su</command>
<prompt>Password:</prompt> <replaceable>password</replaceable>
<prompt>#</prompt> <command>rpm -i *.rpm</command>
</screen>
            </example>

        </section>

    </section>

    <!--
    - From source
    -->

    <section id="getsource">

        <title>Building Guacamole from source</title>
        <indexterm>
            <primary>compiling</primary>
            <secondary>Guacamole</secondary>
        </indexterm>

        <para>
            Building the components of Guacamole from source is not difficult,
            providing you have the necessary tools installed already. The
            source for the entirety of Guacamole is available from the
            Guacamole project web site in convenient source archives, each
            named after the component they contain. Each archive also contains
            a file named README which lists detailed instructions for building
            and installing.
        </para>

        <para>
            To compile the C components, you will need a C compiler (such as
            gcc) and the libraries that each component depends on. Note that
            many Linux distribution separates library packages into binary and
            "development" packages; you will need to install the development
            packages. These will usually end in a "-dev" or "-devel" suffix.
        </para>

        <section id="compilinglibguac">

            <title>Compiling libguac</title>
            <indexterm>
                <primary>compiling</primary>
                <secondary>libguac</secondary>
            </indexterm>

            The core Guacamole C library, libguac, is a common dependency of
            all native components of Guacamole. It depends on Cairo, a graphics
            library, and libpng, the official PNG library. Once you have
            installed these dependencies, building libguac is easy:

            <example>
                <title>Building libguac from source</title>
                <screen>
<prompt>$</prompt> <command>tar -xzf libguac-0.6.2.tar.gz</command>
<prompt>$</prompt> <command>cd libguac-0.6.2/</command>
<prompt>$</prompt> <command>./configure</command>
<prompt>$</prompt> <command>make</command>
<prompt>$</prompt> <command>sudo make install</command>
<prompt>$</prompt> <command>sudo ldconfig</command>
                </screen>
            </example>

        </section>

        <section id="compilingguacd">

            <title>Compiling guacd</title>
            <indexterm>
                <primary>compiling</primary>
                <secondary>guacd</secondary>
            </indexterm>

            <para>
                Once libguac is compiled and installed, guacd and protocol
                support plugins can be compiled and installed as well. None of
                these components can be compiled or installed until after
                libguac as they all depend on it heavily.
            </para>

            <para>
                guacd is the proxy daemon that runs on your Guacamole server,
                accepting connections from the Guacamole web application on
                behalf of remote users. It effectively translates between
                common remote desktop protocols like VNC or RDP by dynamically
                loading protocol support plugins. Building guacd creates an
                executable called guacd which can be run manually or, if you
                wish, automatically when your computer starts up.
            </para>

            <example>
                <title>Building guacd from source</title>
                <screen>
<prompt>$</prompt> <command>tar -xzf guacd-0.6.1.tar.gz</command>
<prompt>$</prompt> <command>cd guacd-0.6.1/</command>
<prompt>$</prompt> <command>./configure</command>
<prompt>$</prompt> <command>make</command>
<prompt>$</prompt> <command>sudo make install</command>
<prompt>$</prompt> <command>sudo ldconfig</command>
                </screen>
            </example>

            <para>
                <indexterm>
                    <primary>guacd</primary>
                    <secondary>startup script</secondary>
                </indexterm>
                If you do not wish guacd to start automatically at boot, leave
                off the --with-init-dir=/etc/init.d option. If the directory
                containing your distribution's startup scripts differs from the
                common /etc/init.d, replace /etc/init.d with the proper
                directory here. You may need to consult your distribution's
                documentation, or do a little digging in /etc, to determine the
                proper location.
            </para>

            <para>
                Even after installing guacd and its startup script, you will
                likely still have to activate the service for it to start
                automatically. Doing this varies by distribution, but each
                distribution will have documentation describing how to do so.
            </para>

        </section>

        <section id="compilingvnc">
            <title>VNC support</title>

            <para>
                All protocol support in Guacamole is modular, even VNC, the
                first protocol supported by Guacamole, and the protocol
                provided by default in all Guacamole installations.
            </para>

            <para>
                <indexterm>
                    <primary>compiling</primary>
                    <secondary>VNC</secondary>
                </indexterm>
                Building the VNC support plugin, libguac-client-vnc, requires
                libvncclient, which is part of libvncserver, a library that
                provides a client and server implementation of VNC.
            </para>

            <example>
                <title>Building libguac-client-vnc from source</title>
                <screen>
<prompt>$</prompt> <command>tar -xzf libguac-client-vnc-0.6.0.tar.gz</command>
<prompt>$</prompt> <command>cd libguac-client-vnc-0.6.0/</command>
<prompt>$</prompt> <command>./configure</command>
<prompt>$</prompt> <command>make</command>
<prompt>$</prompt> <command>sudo make install</command>
<prompt>$</prompt> <command>sudo ldconfig</command>
                </screen>
            </example>

        </section>

        <section id="compilingrdp">
            <title>RDP support</title>

            <para>
                <indexterm>
                    <primary>compiling</primary>
                    <secondary>RDP</secondary>
                </indexterm>
                RDP support in Guacamole requires FreeRDP, specifically FreeRDP
                version 1.0 or newer. The API of FreeRDP changed significantly
                after 1.0 (it was completely rewritten), thus Guacamole's RDP
                support (libguac-client-rdp) cannot be built against any older
                version.
            </para>

            <example>
                <title>Building libguac-client-rdp from source</title>
                <screen>
<prompt>$</prompt> <command>tar -xzf libguac-client-rdp-0.6.1.tar.gz</command>
<prompt>$</prompt> <command>cd libguac-client-rdp-0.6.1/</command>
<prompt>$</prompt> <command>./configure</command>
<prompt>$</prompt> <command>make</command>
<prompt>$</prompt> <command>sudo make install</command>
<prompt>$</prompt> <command>sudo ldconfig</command>
                </screen>
            </example>

        </section>

        <section id="compilingwar">
            <title>Building the web application (guacamole.war)</title>
            <indexterm>
                <primary>compiling</primary>
                <secondary>guacamole.war</secondary>
            </indexterm>

            <para>
                To compile the Java and Maven components of Guacamole
                (guacamole, guacamole-common, guacamole-ext, and
                guacamole-common-js), all you need is Apache Maven and a copy
                of the Java JDK, both of which most Linux distributions provide
                packages of. Because Java is cross-platform, this is generally
                not necessary unless you want to modify the Guacamole source.
                Even if you wish to modify the Guacamole web application, you
                still generally do not need to compile the other Java and Maven
                components, as Maven will automatically download compiled
                versions of those components from the official Maven repository
                of the Guacamole project [guac-dev.org/repo].
            </para>

            <example>
                <title>Building Guacamole from source</title>
                <screen>
<prompt>$</prompt> <command>tar -xzf guacamole-0.6.1.tar.gz</command>
<prompt>$</prompt> <command>cd guacamole-0.6.1/</command>
<prompt>$</prompt> <command>mvn package</command>
                </screen>
            </example>

            <para>
                Once the Guacamole web application is built, there will be a
                .war file in the target/ subdirectory of the current directory
                (the directory you were in when you ran mvn). This .war file
                contains the entirety of the Guacamole web application,
                including all dependencies. Installing Guacamole means copying
                this .war file into the directory required by your servlet
                container.
            </para>

            <example>
                <title>Installing Guacamole after building from source</title>
                <screen>
<prompt>$</prompt> <command>sudo cp target/guacamole-0.6.0.war /var/lib/tomcat6/webapps/guacamole.war</command>
                </screen>
            </example>

            <para>
                The Guacamole web application also depends on a configuration
                file, guacamole.properties, to tell it the type of
                authentication to use, and how to connect to guacd. A
                functional example guacamole.properties is contained in the
                doc/ subdirectory; you can simply copy this somewhere (like
                /etc/guacamole) and then create a symbolic link to it somewhere
                in your servlet container's classpath. Again, the precise
                location of the classpath will vary by distribution and servlet
                container.
            </para>

            <example>
                <title>Installing guacamole.properties</title>
                <screen>
<prompt>$</prompt> <command>sudo mkdir /etc/guacamole</command>
<prompt>$</prompt> <command>sudo cp doc/guacamole.properties /etc/guacamole/guacamole.properties</command>
<prompt>$</prompt> <command>sudo ln -s /etc/guacamole/guacamole.properties /usr/share/tomcat6/lib/</command>
                </screen>
            </example>

            <para>
                You will need to edit guacamole.properties to be sure that all
                the settings are valid for your installation.
            </para>

            <para>
                If you are using the default authentication method, you will
                also need to install the user-mapping.xml file. This file
                describes the users that should be allowed to log into
                Guacamole, as well as their passwords, and all corresponding
                remote desktop connections they should have access to.
            </para>

            <para>
                An example user-mapping.xml file is provided in the doc/
                subdirectory. You can simply copy this file to a reasonable
                location (like /etc/guacamole/user-mapping.xml) and then edit
                guacamole.properties to specify the correct location of this
                file.
            </para>

            <para>
                You will need to edit user-mapping.xml to add and remove users,
                as well as to remove the "default" users included as examples.
            </para>

        </section>

    </section>

    <!--
    - From git 
    -->

    <section id="getgit">

        <title>The absolute latest</title>
        <indexterm>
            <primary>git</primary>
        </indexterm>

        <para>
            If you wish to, at your own risk, build the absolute latest
            unstable code, you can do so by downloading the latest Guacamole
            code from git.
        </para>

        <para>
            The Guacamole project maintains each of its components in separate
            git repositories, which each have master (stable) and unstable
            (development) branches. To build and install the latest source, you
            need only clone the unstable branch of each repository, and then
            build as shown above.
        </para>

        <example>
            <title>Checking out Guacamole from git</title>
            <screen>
$ git clone <uri>git://REPOSITORY -b unstable</uri>
            </screen>
        </example>

        <para>
            As there are several repositories, you will run this git command to
            clone each of the repositories you wish to build.
        </para>

        <table>
            <title>Guacamole git repositories</title>

            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Component</entry>
                        <entry>Repository URL</entry>
                    </row>
                </thead>

                <tbody>
                    <row>
                        <entry>libguac</entry>
                        <entry><uri>git://guacamole.git.sourceforge.net/gitroot/guacamole/libguac</uri></entry>
                    </row>
                    <row>
                        <entry>libguac-client-vnc</entry>
                        <entry><uri>git://guacamole.git.sourceforge.net/gitroot/guacamole/libguac-client-vnc</uri></entry>
                    </row>
                    <row>
                        <entry>libguac</entry>
                        <entry><uri>git://guacamole.git.sourceforge.net/gitroot/guacamole/libguac-client-rdp</uri></entry>
                    </row>
                    <row>
                        <entry>guacd</entry>
                        <entry><uri>git://guacamole.git.sourceforge.net/gitroot/guacamole/guacd</uri></entry>
                    </row>
                    <row>
                        <entry>guacamole-common</entry>
                        <entry><uri>git://guacamole.git.sourceforge.net/gitroot/guacamole/guacamole</uri></entry>
                    </row>
                    <row>
                        <entry>guacamole-common-js</entry>
                        <entry><uri>git://guacamole.git.sourceforge.net/gitroot/guacamole/guacamole-common-js</uri></entry>
                    </row>
                    <row>
                        <entry>guacamole-ext</entry>
                        <entry><uri>git://guacamole.git.sourceforge.net/gitroot/guacamole/guacamole-ext</uri></entry>
                    </row>
                    <row>
                        <entry>guacamole</entry>
                        <entry><uri>git://guacamole.git.sourceforge.net/gitroot/guacamole/guacamole</uri></entry>
                    </row>
                </tbody>
            </tgroup>

        </table>

    </section>

</chapter>
