<?xml version="1.0" encoding="UTF-8"?>

<chapter xml:id="vnc-support" xmlns="http://docbook.org/ns/docbook"
    version="5.0" xml:lang="en" xmlns:xi="http://www.w3.org/2001/XInclude">
    <title>VNC</title>
    <para>The VNC protocol is the simplest and first protocol supported by
        Guacamole. Although generally not as fast as RDP, many VNC servers are
        adequate, and VNC over Guacamole tends to be faster than VNC by itself
        due to decreased bandwidth usage.</para>
    <para>VNC support for Guacamole is provided by the
            <package>libguac-client-vnc</package> library, installed by
        default.</para>
    <section xml:id="vnc-parameters">
        <title>Configuration parameters</title>
        <variablelist>
            <varlistentry>
                <term><parameter>hostname</parameter></term>
                <listitem>
                    <para>The hostname or IP address of the VNC server Guacamole
                        should connect to.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><parameter>port</parameter></term>
                <listitem>
                    <para>The port the VNC server is listening on, usually 5900
                        or 5900 + <replaceable>display number</replaceable>. For
                        example, if your VNC server is serving display number 1
                        (sometimes written as <constant>:1</constant>), your
                        port number here would be 5901.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><parameter>password</parameter></term>
                <listitem>
                    <para>The password to use when attempting authentication, if
                        any. This parameter is optional.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><parameter>read-only</parameter></term>
                <listitem>
                    <para>Whether this connection should be read-only. If set to
                        "true", no input will be accepted on the connection at
                        all. Users will only see the desktop and whatever other
                        users using that same desktop are doing. This parameter
                        is optional.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><parameter>swap-red-blue</parameter></term>
                <listitem>
                    <para>If the colors of your display appear wrong (blues
                        appear orange or red, etc.), it may be that your VNC
                        server is sending image data incorrectly, and the red
                        and blue components of each color are swapped. If this
                        is the case, set this parameter to "true" to work around
                        the problem. This parameter is optional.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><parameter>encodings</parameter></term>
                <listitem>
                    <para>A space-delimited list of VNC encodings to use. The
                        format of this parameter is dictated by libvncclient and
                        thus doesn't really follow the form of other Guacamole
                        parameters. This parameter is optional, and
                            <package>libguac-client-vnc</package> will use any
                        supported encoding by default.</para>
                    <para>Beware that this parameter is intended to be replaced
                        with individual, encoding-specific parameters in a
                        future release.</para>
                </listitem>
            </varlistentry>
        </variablelist>
    </section>
    <section xml:id="adding-vnc">
        <title>Adding a VNC connection</title>
        <para>If you are using the default authentication built into Guacamole,
            and you wish to grant access to a VNC connection to a particular
            user, you need to locate the <code>&lt;authorize></code> section for
            that user within your <filename>user-mapping.xml</filename>, and add
            a section like the following within it:</para>
        <programlisting>&lt;connection name="<replaceable>Unique Name</replaceable>">
    &lt;protocol>vnc&lt;/protocol>
    &lt;param name="hostname"><replaceable>localhost</replaceable>&lt;/param>
    &lt;param name="port"><replaceable>5901</replaceable>&lt;/param>
&lt;/connection></programlisting>
        <para>If added exactly as above, a new connection named
                "<replaceable>Unique Name</replaceable>" will be available to
            the user associated with the <code>&lt;authorize></code> section
            containing it. The connection will use VNC to connect to
                <replaceable>localhost</replaceable> at port
                <replaceable>5901</replaceable>. Naturally, you will want to
            change some or all of these values.</para>
        <para>If your VNC server requires a password, or you wish to specify
            other configuration parameters (to reduce the color depth, for
            example), you will need to add additional <code>&lt;param></code>
            tags accordingly.</para>
        <para>Other authentication methods will provide documentation describing
            how to configure new connections. If the authentication method in
            use fully implements the features of Guacamole 0.8.0, you will be
            able to add a new VNC connection easily and intuitively using the
            administration interface built into Guacamole. You will not need to
            edit configuration files.</para>
    </section>
    <section>
        <title>Which VNC server?</title>
        <para>The choice of VNC server can make a big difference when it comes
            to performance, especially over slower networks. While many systems
            provide VNC access by default, using this is often not the fastest
            method.</para>
        <section>
            <title>RealVNC or TigerVNC</title>
            <para>RealVNC, and its derivative TigerVNC, perform quite well. In
                our testing, they perform the best with Guacamole. If you are
                okay with having a desktop that can only be accessed via VNC,
                one of these is likely your best choice. Both optimize window
                movement and (depending on the application) scrolling, giving a
                very responsive user experience.</para>
        </section>
        <section>
            <title>TightVNC</title>
            <para>TightVNC is widely-available and performs generally as well as
                RealVNC or TigerVNC. If you wish to use TightVNC with Guacamole,
                performance should be just fine, but we highly recommend
                disabling its JPEG encoding. This is because images transmitted
                to Guacamole are always encoded losslessly as PNG images. When
                this operation is performed on a JPEG image, the artifacts
                present from JPEG's lossy compression reduce the compressibility
                of the image for PNG, thus leading to a slower experience
                overall than if JPEG was simply not used to begin with.</para>
        </section>
        <section>
            <title>x11vnc</title>
            <para>The main benefit of using x11vnc is that it allows you to
                continue using your desktop normally, while simultaneously
                exposing control of your desktop via VNC. Performance of x11vnc
                is comparable to RealVNC, TigerVNC, and TightVNC. If you need to
                use your desktop locally as well as via VNC, you will likely be
                quite happy with x11vnc.</para>
        </section>
        <section>
            <title>vino</title>
            <para>vino is the VNC server that comes with the Gnome desktop
                environment, and is enabled if you enable "desktop sharing" via
                the system preferences available within Gnome. If you need to
                share your local desktop, we recommend using x11vnc rather vino,
                as it has proven more performant and feature-complete in our
                testing. If you don't need to share a local desktop but simply
                need an environment you can access remotely, using a VNC server
                like RealVNC, TigerVNC, or TightVNC is a better choice.</para>
        </section>
        <section>
            <title>QEMU or KVM</title>
            <para>QEMU (and thus KVM) expose the displays of virtual machines
                using VNC. If you need to see the virtual monitor of your
                virtual machine, using this VNC connection is really your only
                choice. As the VNC server built into QEMU cannot be aware of
                higher-level operations like window movement, resizing, or
                scrolling, those operations will tend to be sent suboptimally,
                and will not be as fast as a VNC server running within the
                virtual machine.</para>
            <para>If you wish to use a virtual machine for desktop access, we
                recommend installing a native VNC server inside the virtual
                machine after the virtual machine is set up. This will give a
                more responsive desktop.</para>
        </section>
    </section>
</chapter>
